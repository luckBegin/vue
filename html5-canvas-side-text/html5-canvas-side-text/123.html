<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        * {
            margin: 0px;
            padding: 0px;
        }

        html, body {
            width: 100%;
            height: 100%;
        }

        .canvas_bgp {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            margin: 0px;
            padding: 0px;
        }

        #canvas {
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
        }

    </style>
</head>
<body>
<canvas id="canvas">

</canvas>
<img src="./bg_sign.png" class="canvas_bgp">
<script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
<script>
    var image = new Image();
    var dots = [];
    image.src = './default.png';

    var image2 = new Image();
    image2.src = './raw.png';
    image2.onload = function () {
        dots = getimgData("YGA");
        initAnimate();
    };

    var imgObj = [];
    var canvas = document.getElementById("canvas");
    var context = canvas.getContext('2d');

    canvas.width = 949 ;
    canvas.height = 363 ;

    focallength = 100;

    var drawText = function (text) {
        context.save()
        context.drawImage(image2, 0, 0);

        console.log(image2.width)
        context.restore();
    };

    function getimgData(text) {
        drawText(text);
        // var imgData = context.getImageData(0, 0, canvas.width, canvas.height);
        // context.clearRect(0, 0, canvas.width, canvas.height);
        // var dots = [];
        // for (var x = 0; x < imgData.width; x += 25) {
        //     for (var y = 0; y < imgData.height; y += 25) {
        //         var i = (y * imgData.width + x) * 4;
        //         if (imgData.data[i] > 0) {
        //             var dot = new Dot(x + 3, y + 3, 0, 3, dots.length);
        //             dots.push(dot);
        //         }
        //     }
        // };
        // return dots;
    }
    //
    // var Dot = function (centerX, centerY, centerZ, radius, index) {
    //     this.dx = centerX;
    //     this.dy = centerY;
    //     this.dz = centerZ;
    //
    //     this.z = centerZ;
    //     this.x = centerX;
    //     this.y = centerY;
    //     this.radius = radius;
    //
    //     this.index = index;
    // }
    //
    // Dot.prototype = {
    //     paint: function (index) {
    //         context.save();
    //         context.beginPath();
    //         var scale = focallength / (focallength + this.z);
    //         var _img = null;
    //
    //         if (imgObj[this.index])
    //             _img = imgObj[this.index];
    //         else
    //             _img = image;
    //         context.drawImage(_img, canvas.width / 2 + (this.x - canvas.width / 2) * scale + canvas.width / 4, canvas.height / 2 + (this.y - canvas.height / 2) * scale + canvas.height / 6, 25, 25);
    //         context.stroke()
    //         context.restore();
    //     }
    // };
    //
    //
    // function initAnimate() {
    //     dots.forEach((_this, index) => {
    //         _this.x = Math.random() * canvas.width;
    //         _this.y = Math.random() * canvas.height;
    //         _this.z = Math.random() * focallength * 2 - focallength;
    //
    //         _this.tx = Math.random() * canvas.width;
    //         _this.ty = Math.random() * canvas.height;
    //         _this.tz = Math.random() * focallength * 2 - focallength;
    //         _this.paint(index);
    //     });
    //     animate();
    // };
    //
    // var derection = true;
    //
    // function animate() {
    //     context.clearRect(0, 0, canvas.width, canvas.height);
    //     dots.forEach(function (item, index) {
    //         var dot = item;
    //         if (derection === true) {
    //             if (Math.abs(dot.dx - dot.x) < 0.1 && Math.abs(dot.dy - dot.y) < 0.1 && Math.abs(dot.dz - dot.z) < 0.1) {
    //                 setTimeout(function(){
    //                     derection = false ;
    //                 } , 10000)
    //             } else {
    //                 dot.x = dot.x + (dot.dx - dot.x) * 0.04;
    //                 dot.y = dot.y + (dot.dy - dot.y) * 0.04;
    //                 dot.z = dot.z + (dot.dz - dot.z) * 0.04;
    //             }
    //             ;
    //         } else {
    //             if (Math.abs(dot.tx - dot.x) < 0.1 && Math.abs(dot.ty - dot.y) < 0.1 && Math.abs(dot.tz - dot.z) < 0.1) {
    //                 derection = true;
    //             } else {
    //                 dot.x = dot.x + (dot.tx - dot.x) * 0.03;
    //                 dot.y = dot.y + (dot.ty - dot.y) * 0.03;
    //                 dot.z = dot.z + (dot.tz - dot.z) * 0.03;
    //             }
    //             ;
    //         }
    //         ;
    //         dot.paint(index);
    //     });
    //     requestAnimationFrame(animate);
    // };
    // var obj = [];
    // var start = function () {
    //     $.ajax({
    //         url: "https://kmgoapi.yoopoon.com/api/home/GetwdaGetUserinfo",
    //         method: "GET",
    //         success: function (data) {
    //             if (data.Status === 1 && data.Values && data.Values.length > 0) {
    //                 data.Values.forEach(item => {
    //                     if (obj[item.UserWXopenId]) {
    //                     } else {
    //                         obj[item.UserWXopenId] = true;
    //                         var img = new Image();
    //                         img.src = item.UserWXimg;
    //                         img.onload = function () {
    //                             imgObj.push(img);
    //                         };
    //                     }
    //
    //                 });
    //             } else {
    //                 alert("获取当前在线用户失败");
    //             }
    //         }
    //     })
    // };
    // setInterval(start(), 10000);
    // start();
</script>
</body>
</html>