<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Document</title>
<style>
*{
    margin:0px;
    padding: 0px;
}
html , body{
    width: 100% ; 
    height: 100% ;
}
</style>
</head>
<body>
<canvas id="canvas">

</canvas>
<script>
var getRandomColor = function (){
     var r = Math.floor(Math.random()*255);
     var g = Math.floor(Math.random()*255);
     var b = Math.floor(Math.random()*255);
     return 'rgba('+ 0 +','+ 0 +','+ 0 +',0.8)';
};

var image = new Image();
image.src = './1.jpg' ;

var canvas = document.getElementById("canvas");
var context = canvas.getContext('2d');

canvas.width = document.body.clientWidth ;
canvas.height = document.body.clientHeight ;

focallength = 250 ;

var drawText = function(text){
    context.save()
    context.font = "650px 微软雅黑 bolder";
    context.fillStyle = "rgba(168,168,168,1)";
    context.textAlign = "center";
    context.textBaseline = "middle";
    context.fillText(text , canvas.width/2 , canvas.height/2);
    context.restore();
}
function getimgData(text){
    drawText(text);
    var imgData = context.getImageData(0,0,canvas.width , canvas.height);
    context.clearRect(0,0,canvas.width , canvas.height);
    var dots = [];
    for(var x=0 ; x < imgData.width ; x += 36 ){
        for(var y = 0;y<imgData.height ; y+= 36 ){
            var i = ( y * imgData.width + x) * 4 ;
            if(imgData.data[i] >= 128){
                var dot = new Dot( x + 3 , y + 3 , 0 , 3);
                dots.push(dot);
            }
        }
    }
    return dots;
}
var Dot = function(centerX , centerY , centerZ , radius){
    this.dx = centerX;
    this.dy = centerY;
    this.dz = centerZ;

    this.z = centerZ;
    this.x = centerX;
    this.y = centerY;
    this.radius = radius;
}

Dot.prototype = {
    paint:function(){
        context.save();
        context.beginPath();
        var scale = focallength/(focallength + this.z);

        context.drawImage( image , canvas.width/2 + (this.x-canvas.width/2)*scale , canvas.height/2 + (this.y-canvas.height/2) * scale , 36 , 36 );
        context.strokeStyle = getRandomColor() ;
        context.stroke()
        context.restore();
    }
};

var dots = getimgData("YGA");

function initAnimate(){
    dots.forEach( (_this) => {
        _this.x = Math.random()*canvas.width;
        _this.y = Math.random()*canvas.height;
        _this.z = Math.random()*focallength*2 - focallength;

        _this.tx = Math.random()*canvas.width;
        _this.ty = Math.random()*canvas.height;
        _this.tz = Math.random()*focallength*2 - focallength;
        _this.paint();
    });
    animate();
};
initAnimate();

var derection = true ;
function animate(){
    context.clearRect(0,0,canvas.width , canvas.height);
    dots.forEach(function(item){
        var dot = item;

        if(derection === true ){
            if( Math.abs(dot.dx - dot.x) < 0.1 && Math.abs(dot.dy - dot.y ) < 0.1 && Math.abs(dot.dz - dot.z) < 0.1){
                derection = false ; 
            }else{
                dot.x = dot.x + (dot.dx - dot.x) * 0.04;
                dot.y = dot.y + (dot.dy - dot.y) * 0.04;
                dot.z = dot.z + (dot.dz - dot.z) * 0.04;
            };
        }else{
            if (Math.abs(dot.tx - dot.x) < 0.1 && Math.abs(dot.ty - dot.y) < 0.1 && Math.abs(dot.tz - dot.z)<0.1) {
                derection = true;
            } else {
                dot.x = dot.x + (dot.tx - dot.x) * 0.02 ;
                dot.y = dot.y + (dot.ty - dot.y) * 0.02 ;
                dot.z = dot.z + (dot.tz - dot.z) * 0.02 ;
            };
        };
        dot.paint();
    });
    requestAnimationFrame(animate);
};
</script>
</body>
</html>