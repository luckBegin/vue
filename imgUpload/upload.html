<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<link rel="stylesheet" type="text/css" href="./css/upload.css">
<title>图片上传</title>
</head>
<body>
<header>
	<img src="./img/banner.png" style="width: 100%;height: 500px;">
<!-- 	<div class="banner">
		
	</div> -->
</header>
<div class="tip">
	<img src="./img/tip.png">
</div>
<div class="imgList">
	<div class="imgSection">
		<img src="./img/uploadBtn.png" class="imgItem">
		<input type="file" name="" id="imgupLoad" accept="image/*" onchange="uploadImage(event)">
	</div>
</div>
<script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
<script>

var makeHtml = function(index , imagePath){
	return '	<div class="imgSection">'+
'		<img src="'+imagePath+'" class="imgItem">'+
'		<div class="delItem">'+
'			<img src="./img/del.png" class="delBtn" onclick="delImg('+index+')">'+
'		</div>'+
'	</div>';
};
var url = 'http://lijiang-api.jpgqs.cn/api/imageUpload' ;
var delImg = function(index){
    $.ajax({
        url: url + "?id=" + index ,
        method : "DELETE" ,
        success: function(res){
            if(res.success){
                alert("删除成功") ;
                window.location.reload() ;
            }else{
                alert("删除图片失败") ;
            }
        }
    });
};
var getList = function(){
    $.ajax({
        url: url ,
		method : "GET" ,
		success: function(res){
            if(res.success){
                var list = res.data.all ;

                var html = ''
                list.forEach( ( item , index ) => {
                    html += makeHtml(index , "http://lijiang-api.jpgqs.cn/" + item.path )
                });

                $(".imgList").append(html) ;

                $(".imgSection").mouseover(function(){
                    $(this).find("div").show() ;
                });
                $(".imgSection").mouseout(function(){
                    $(this).find("div").hide()
                });
            }else{
                alert("获取图片失败") ;
            }
		}
	})
};

getList() ;
var uploadImage = function($event){
    var file = $event.target.files[0] ;

    if(/jpg|png|jpeg/g.test(file.name)){
        var formData = new FormData() ;
        formData.append("img" , file ) ;
        $.ajax({
            url: url + "?name=" + Date.now(),
            type: 'post',
            processData: false,
            contentType: false,
            data: formData,
            success: function (res) {
                if(res.success){
                    alert("上传成功") ;
                    var current = res.data.current.path ;
                    $.ajax({
                        url: "https://kmgoapi.yoopoon.com/api/home/wdaInsertImg?strImgress="+current,
                        type: 'GET',
                        success: function (res) {}
                    });
                    // window.location.reload() ;
				}else{
                    alert("上传失败") ;
				}
            }
        });
	}else{
        alert("请选择图片")
	};
};
</script>
</body>
</html>
